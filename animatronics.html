<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animatronic Control Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* General Body Styles */
        html, body { height: 100%; margin: 0; padding: 0; }
        body { font-family: 'VT323', monospace; background-color: #1a1a1a; color: white; text-align: center; user-select: none; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 10px; box-sizing: border-box; }
        .container { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .screen-constrained { max-width: 420px; }
        h1 { color: #ff4500; font-size: 2.5em; text-shadow: 2px 2px #000; margin: 0 0 15px 0; }
        h2 { color: #ccc; font-size: 1.5em; margin: 15px 0 5px 0; }
        .hidden { display: none !important; }
        input[type="text"] { font-family: 'VT323', monospace; font-size: 1.5em; width: 90%; max-width: 400px; padding: 10px; margin-bottom: 10px; background-color: #0a0a0a; border: 3px solid #555; color: white; text-align: center; }
        button { width: 90%; max-width: 400px; margin: 8px 0; padding: 15px; font-family: 'VT323', monospace; font-size: 1.8em; cursor: pointer; border: 3px solid #ff4500; background-color: transparent; color: #ff4500; transition: all 0.2s ease; }
        button:hover:not(:disabled) { background-color: #ff4500; color: #fff; }
        button:disabled { border-color: #555; color: #555; cursor: not-allowed; }
        .selection-group { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .color-swatch { width: 40px; height: 40px; cursor: pointer; border: 4px solid #444; }
        .color-swatch.selected { border-color: #fff; }
        #avatar-selection-area { display: flex; align-items: center; justify-content: center; gap: 20px; width: 100%; }
        #show-avatar-screen-button { width: 60%; margin: 8px 0; }
        #selected-avatar-preview { width: 80px; height: 80px; border: 4px solid #fff; visibility: hidden; object-fit: cover; }
        .controls-buttons { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .sound-btn { border-color: #7a00ff; color: #7a00ff; }
        .ability-btn { border-color: #ff00de; color: #ff00de; }
        .chat-mode { display: flex; align-items: center; justify-content: center; gap: 10px; margin: 5px 0; color: #aaa; }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #7a00ff; }
        input:checked + .slider:before { transform: translateX(26px); }
        #message-log { width: 90%; max-width: 400px; height: 120px; background-color: #0a0a0a; border: 3px solid #555; margin-top: 20px; padding: 10px; list-style: none; overflow-y: auto; text-align: left; font-size: 1.1em; box-sizing: border-box; }
        #message-log li { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px dashed #333; word-break: break-all; }
        .message-avatar { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #555; flex-shrink: 0; }
        
        /* RESPONSIVE AVATAR CAROUSEL STYLES */
        #avatar-screen { width: 100%; }
        #avatar-name-display { font-size: 2em; color: #ffdc00; height: 35px; margin-bottom: 10px; }
        #avatar-carousel-wrapper { display: flex; align-items: center; justify-content: center; width: 100%; }
        #avatar-carousel { width: 90vw; height: 250px; overflow: hidden; position: relative; }
        #avatar-strip { display: flex; align-items: center; height: 100%; position: absolute; left: 0; top: 0; transition: transform 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        .carousel-avatar { width: 200px; height: 200px; object-fit: cover; margin: 25px 15px; border: 5px solid #555; transition: all 0.5s ease; opacity: 0.3; transform: scale(0.6); cursor: pointer; }
        .carousel-avatar.active { border-color: #ffdc00; opacity: 1; transform: scale(1); }
        .nav-button { font-size: 3em; border: none; background: none; color: #fff; padding: 0 5px; z-index: 10; }

        @media (min-width: 768px) {
            #avatar-screen { max-width: 800px; }
            #avatar-name-display { font-size: 2.5em; height: 40px; }
            #avatar-carousel { width: 700px; height: 350px; }
            .carousel-avatar { width: 300px; height: 300px; margin: 25px 20px; }
            .nav-button { font-size: 4em; padding: 0 20px; }
        }
    </style>
</head>
<body>

    <div id="join-screen" class="container screen-constrained">
        <h1>Animatronic Setup</h1>
        <input type="text" id="player-name-input" placeholder="Enter Your Name" maxlength="12">
        <h2>Choose Your Color</h2>
        <div class="selection-group" id="color-selector">
            <div class="color-swatch" data-color="#ff4136" style="background-color:#ff4136;"></div>
            <div class="color-swatch" data-color="#0074d9" style="background-color:#0074d9;"></div>
            <div class="color-swatch" data-color="#2ecc40" style="background-color:#2ecc40;"></div>
            <div class="color-swatch" data-color="#ffdc00" style="background-color:#ffdc00;"></div>
            <div class="color-swatch" data-color="#b10dc9" style="background-color:#b10dc9;"></div>
        </div>
        <h2>Choose Your Avatar</h2>
        <div id="avatar-selection-area">
            <button id="show-avatar-screen-button">Select Avatar</button>
            <img id="selected-avatar-preview" src="">
        </div>
        <input type="text" id="room-code-input" placeholder="Enter Room Code" maxlength="4">
        <button id="join-button">Join Game</button>
    </div>

    <div id="avatar-screen" class="container hidden">
        <h1>Choose Your Animatronic</h1>
        <h2 id="avatar-name-display">Freddy</h2>
        <div id="avatar-carousel-wrapper">
            <button id="prev-avatar" class="nav-button">◄</button>
            <div id="avatar-carousel">
                <div id="avatar-strip"></div>
            </div>
            <button id="next-avatar" class="nav-button">►</button>
        </div>
        <button id="confirm-avatar-button">Select This Animatronic</button>
    </div>

    <div id="controls-screen" class="container screen-constrained hidden">
        <h1 id="room-title">Room: ABCD</h1>
        <div class="controls-buttons">
            <button id="ad-button">Activate Annoying Ad (30s)</button>
            <button id="sabotage-button" class="ability-btn">Sabotage Task (60s)</button>
            <button id="glitch-button" class="ability-btn">System Glitch (45s)</button>
            <input type="text" id="message-input" placeholder="Type a message..." maxlength="50">
            <div class="chat-mode">
                <span>Public</span>
                <label class="switch"><input type="checkbox" id="chat-mode-toggle"><span class="slider"></span></label>
                <span>Private</span>
            </div>
            <button id="send-button">Send Message</button>
            <button class="sound-btn" data-sound="laugh">Freddy's Laugh</button>
            <button class="sound-btn" data-sound="beatbox">Freddy Beatbox</button>
            <button class="sound-btn" data-sound="glitch">Golden Freddy</button>
            <button class="sound-btn" data-sound="scream">Scream</button>
        </div>
        <ul id="message-log" class="hidden"></ul>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        const socket = io('https://8b503b84-132c-4149-bdb3-8bef57ec4fd8-00-2ga0ewjtdd2yk.worf.replit.dev');

        const avatars = [
            { name: 'Freddy', path: 'avatars/avatar1.jpg' }, { name: 'Bonnie', path: 'avatars/avatar2.jpg' },
            { name: 'Chica', path: 'avatars/avatar3.jpg' }, { name: 'Foxy', path: 'avatars/avatar4.jpg' },
            { name: 'Spring Trap', path: 'avatars/avatar5.jpg' }, { name: 'Toy Freddy', path: 'avatars/avatar6.jpg' },
            { name: 'Toy Bonnie', path: 'avatars/avatar7.jpg' }, { name: 'Toy Chica', path: 'avatars/avatar8.jpg' },
            { name: 'Mangle', path: 'avatars/avatar9.jpg' }, { name: 'Balloon Boy', path: 'avatars/avatar10.jpg' },
            { name: 'The Puppet', path: 'avatars/avatar11.jpg' }, { name: 'JJ', path: 'avatars/avatar12.jpg' },
            { name: 'Golden Freddy', path: 'avatars/avatar13.jpg' }, { name: 'Phantom Freddy', path: 'avatars/avatar14.jpg' },
            { name: 'Phantom BB', path: 'avatars/avatar15.jpg' }, { name: 'Withered Bonnie', path: 'avatars/avatar16.jpg' },
            { name: 'Nightmare Freddy', path: 'avatars/avatar17.jpg' }, { name: 'Nightmare', path: 'avatars/avatar18.jpg' },
            { name: 'Nightmare Bonnie', path: 'avatars/avatar19.jpg' }, { name: 'Jack-O-Chica', path: 'avatars/avatar20.jpg' },
            { name: 'Nightmare Fredbear', path: 'avatars/avatar21.jpg' }, { name: 'Nightmare BB', path: 'avatars/avatar22.jpg' },
            { name: 'Rockstar Freddy', path: 'avatars/avatar23.jpg' }, { name: 'Rockstar Bonnie', path: 'avatars/avatar24.jpg' },
            { name: 'Rockstar Chica', path: 'avatars/avatar25.jpg' }, { name: 'Rockstar Foxy', path: 'avatars/avatar26.jpg' },
            { name: 'Mr. Hippo', path: 'avatars/avatar27.jpg' }, { name: 'Happy Frog', path: 'avatars/avatar28.jpg' },
            { name: 'Pig Patch', path: 'avatars/avatar29.jpg' }, { name: 'Orville', path: 'avatars/avatar30.jpg' },
            { name: 'Trash and the Gang', path: 'avatars/avatar31.jpg' }, { name: 'Lefty', path: 'avatars/avatar32.jpg' },
            { name: 'Phone Guy', path: 'avatars/avatar33.jpg' }, { name: 'Old Man Consequences', path: 'avatars/avatar34.jpg' },
            { name: 'Nightmarionne', path: 'avatars/avatar35.jpg' }, { name: 'Ghostface', path: 'avatars/avatar36.jpg' },
            { name: 'Viper Ghostface', path: 'avatars/avatar37.jpg' }, { name: 'Michael Myers', path: 'avatars/avatar38.jpg' }
        ];

        let selectedColor = null, selectedAvatar = null, currentAvatarIndex = 0;
        
        const joinScreen = document.getElementById('join-screen');
        const avatarScreen = document.getElementById('avatar-screen');
        const controlsScreen = document.getElementById('controls-screen');
        const playerNameInput = document.getElementById('player-name-input');
        const colorSelector = document.getElementById('color-selector');
        const roomCodeInput = document.getElementById('room-code-input');
        const joinButton = document.getElementById('join-button');
        const roomTitle = document.getElementById('room-title');
        const adButton = document.getElementById('ad-button');
        const sabotageButton = document.getElementById('sabotage-button');
        const glitchButton = document.getElementById('glitch-button');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const soundButtons = document.querySelectorAll('.sound-btn');
        const messageLog = document.getElementById('message-log');
        const chatModeToggle = document.getElementById('chat-mode-toggle');
        const showAvatarScreenButton = document.getElementById('show-avatar-screen-button');
        const selectedAvatarPreview = document.getElementById('selected-avatar-preview');
        const avatarStrip = document.getElementById('avatar-strip');
        const avatarNameDisplay = document.getElementById('avatar-name-display');
        const prevAvatarButton = document.getElementById('prev-avatar');
        const nextAvatarButton = document.getElementById('next-avatar');
        const confirmAvatarButton = document.getElementById('confirm-avatar-button');
        
        // --- MODIFICATION START ---
        const cooldownIntervals = {};
        const originalButtonText = {
            ad: adButton.textContent,
            sabotage: sabotageButton.textContent,
            glitch: glitchButton.textContent
        };
        const abilityButtons = {
            ad: adButton,
            sabotage: sabotageButton,
            glitch: glitchButton
        };
        // --- MODIFICATION END ---

        function populateAvatars() {
            avatars.forEach((avatar, index) => {
                const img = document.createElement('img');
                img.src = `https://crandyisatwork.github.io/fnaf-terminal/${avatar.path}`;
                img.classList.add('carousel-avatar');
                img.dataset.index = index;
                if (index === 0) { img.classList.add('active'); }
                img.addEventListener('click', () => { currentAvatarIndex = index; updateCarousel(); });
                avatarStrip.appendChild(img);
            });
            setTimeout(updateCarousel, 100); 
        }

        function updateCarousel() {
            const avatarCarousel = document.getElementById('avatar-carousel');
            const firstAvatar = avatarStrip.querySelector('.carousel-avatar');
            if (!firstAvatar) return;
            const style = window.getComputedStyle(firstAvatar);
            const marginLeft = parseFloat(style.marginLeft);
            const marginRight = parseFloat(style.marginRight);
            const itemWidth = firstAvatar.offsetWidth + marginLeft + marginRight;
            const containerWidth = avatarCarousel.offsetWidth;
            const offset = (containerWidth / 2) - (itemWidth / 2) - (currentAvatarIndex * itemWidth);
            avatarStrip.style.transform = `translateX(${offset}px)`;
            avatarNameDisplay.textContent = avatars[currentAvatarIndex].name;
            document.querySelectorAll('.carousel-avatar').forEach(img => {
                img.classList.remove('active');
                if (parseInt(img.dataset.index) === currentAvatarIndex) { img.classList.add('active'); }
            });
        }
        
        window.addEventListener('resize', updateCarousel);
        showAvatarScreenButton.addEventListener('click', () => { joinScreen.classList.add('hidden'); avatarScreen.classList.remove('hidden'); });
        prevAvatarButton.addEventListener('click', () => { currentAvatarIndex = (currentAvatarIndex > 0) ? currentAvatarIndex - 1 : avatars.length - 1; updateCarousel(); });
        nextAvatarButton.addEventListener('click', () => { currentAvatarIndex = (currentAvatarIndex < avatars.length - 1) ? currentAvatarIndex + 1 : 0; updateCarousel(); });
        confirmAvatarButton.addEventListener('click', () => {
            selectedAvatar = avatars[currentAvatarIndex].path;
            selectedAvatarPreview.src = `https://crandyisatwork.github.io/fnaf-terminal/${selectedAvatar}`;
            selectedAvatarPreview.style.visibility = 'visible';
            avatarScreen.classList.add('hidden');
            joinScreen.classList.remove('hidden');
        });

        colorSelector.addEventListener('click', (e) => {
            if (e.target.classList.contains('color-swatch')) {
                colorSelector.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
                e.target.classList.add('selected');
                selectedColor = e.target.dataset.color;
            }
        });

        joinButton.addEventListener('click', () => {
            const roomCode = roomCodeInput.value.trim().toUpperCase();
            const playerName = playerNameInput.value.trim();
            if (!playerName || !selectedColor || !selectedAvatar || !roomCode) {
                alert('Please enter a name, select a color, choose an avatar, and enter a room code.');
                return;
            }
            socket.emit('join-game', { roomCode, playerName, playerColor: selectedColor, playerAvatar: selectedAvatar });
        });

        // --- MODIFICATION START ---
        adButton.addEventListener('click', () => { socket.emit('use-ability', { ability: 'ad' }); });
        sabotageButton.addEventListener('click', () => { socket.emit('use-ability', { ability: 'sabotage' }); });
        glitchButton.addEventListener('click', () => { socket.emit('use-ability', { ability: 'glitch' }); });
        // --- MODIFICATION END ---

        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            if (message) {
                const isPrivate = chatModeToggle.checked;
                if (isPrivate) { socket.emit('send-private-message', { message: message }); } else { socket.emit('send-message', { message: message }); }
                messageInput.value = '';
            }
        });

        soundButtons.forEach(button => {
            button.addEventListener('click', () => {
                const soundName = button.dataset.sound;
                socket.emit('play-sound', { soundName: soundName });
            });
        });

        socket.on('join-successful', (data) => {
            roomTitle.textContent = `Room: ${data.roomCode}`;
            joinScreen.classList.add('hidden');
            controlsScreen.classList.remove('hidden');
        });
        socket.on('invalid-room', () => { alert('Invalid Room Code. Please try again.'); });
        socket.on('connect', () => { console.log('Successfully connected to the server!'); });
        socket.on('receive-message', (data) => {
            const { message, sender } = data;
            messageLog.classList.remove('hidden');
            const messageItem = document.createElement('li');
            const avatarImg = document.createElement('img');
            const textContainer = document.createElement('div');
            const senderName = document.createElement('strong');
            avatarImg.classList.add('message-avatar');
            avatarImg.src = `https://crandyisatwork.github.io/fnaf-terminal/${sender.avatar}`;
            senderName.textContent = `${sender.name}: `;
            senderName.style.color = sender.color;
            textContainer.appendChild(senderName);
            textContainer.appendChild(document.createTextNode(message));
            messageItem.appendChild(avatarImg);
            messageItem.appendChild(textContainer);
            messageLog.appendChild(messageItem);
            if (messageLog.children.length > 5) { messageLog.removeChild(messageLog.firstChild); }
            messageLog.scrollTop = messageLog.scrollHeight;
        });

        // --- MODIFICATION START ---
        socket.on('start-cooldown', (data) => {
            const { ability, duration } = data;
            const button = abilityButtons[ability];
            if (!button) return;

            button.disabled = true;
            let cooldown = Math.ceil(duration / 1000);
            
            clearInterval(cooldownIntervals[ability]);

            button.textContent = `${originalButtonText[ability].split(' (')[0]} (${cooldown}s)`;
            cooldownIntervals[ability] = setInterval(() => {
                cooldown--;
                button.textContent = `${originalButtonText[ability].split(' (')[0]} (${cooldown}s)`;
                if (cooldown <= 0) {
                    clearInterval(cooldownIntervals[ability]);
                }
            }, 1000);
        });
        
        socket.on('cooldown-ready', (data) => {
            const { ability } = data;
            const button = abilityButtons[ability];
            if (!button) return;

            clearInterval(cooldownIntervals[ability]);
            button.disabled = false;
            button.textContent = originalButtonText[ability];
        });
        // --- MODIFICATION END ---
        
        populateAvatars();
    </script>
</body>
</html>
