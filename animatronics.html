<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Animatronic Control Panel</title>
  <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/1245/1245741.png">
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    /* -------- GENERAL STYLES -------- */
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      font-family: 'VT323', monospace;
      background-color: #1a1a1a;
      color: white;
      text-align: center;
      user-select: none;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 10px;
      box-sizing: border-box;
    }
    .container { display: flex; flex-direction: column; align-items: center; width: 100%; }
    .screen-constrained { max-width: 420px; }
    h1 { color: #ff4500; font-size: 2.5em; text-shadow: 2px 2px #000; margin: 0 0 15px 0; }
    h2 { color: #ccc; font-size: 1.5em; margin: 15px 0 5px 0; }
    .hidden { display: none !important; }

    input[type="text"] {
      font-family: 'VT323', monospace;
      font-size: 1.5em;
      width: 90%;
      max-width: 400px;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #0a0a0a;
      border: 3px solid #555;
      color: white;
      text-align: center;
    }

    button {
      width: 90%;
      max-width: 400px;
      margin: 8px 0;
      padding: 15px;
      font-family: 'VT323', monospace;
      font-size: 1.8em;
      cursor: pointer;
      border: 3px solid #ff4500;
      background-color: transparent;
      color: #ff4500;
      transition: all 0.2s ease;
    }
    button:hover:not(:disabled) { background-color: #ff4500; color: #fff; }
    button:disabled { border-color: #555; color: #555; cursor: not-allowed; }

    /* Colors and avatars */
    .selection-group { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
    .color-swatch { width: 40px; height: 40px; cursor: pointer; border: 4px solid #444; }
    .color-swatch.selected { border-color: #fff; }
    #avatar-selection-area { display: flex; align-items: center; justify-content: center; gap: 20px; width: 100%; }
    #show-avatar-screen-button { width: 60%; margin: 8px 0; }
    #selected-avatar-preview { width: 80px; height: 80px; border: 4px solid #fff; visibility: hidden; object-fit: cover; }

    /* Chat & messages */
    .controls-buttons { display: flex; flex-direction: column; align-items: center; width: 100%; }
    .sound-btn { border-color: #7a00ff; color: #7a00ff; }
    .ability-btn { border-color: #ff00de; color: #ff00de; }
    #message-log {
      width: 90%; max-width: 400px; height: 120px;
      background-color: #0a0a0a; border: 3px solid #555;
      margin-top: 20px; padding: 10px;
      list-style: none; overflow-y: auto; text-align: left;
      font-size: 1.1em; box-sizing: border-box;
    }
    #message-log li { display: flex; align-items: center; gap: 8px; margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px dashed #333; }
    .message-avatar { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #555; flex-shrink: 0; }

    /* Avatar carousel */
    #avatar-screen { width: 100%; }
    #avatar-name-display { font-size: 2em; color: #ffdc00; margin-bottom: 10px; }
    #avatar-carousel { width: 90vw; height: 250px; overflow: hidden; position: relative; }
    #avatar-strip { display: flex; height: 100%; position: absolute; left: 0; top: 0; transition: transform 0.5s; }
    .carousel-avatar { width: 200px; height: 200px; object-fit: cover; margin: 25px 15px; border: 5px solid #555; opacity: 0.3; transform: scale(0.6); cursor: pointer; transition: all 0.5s ease; }
    .carousel-avatar.active { border-color: #ffdc00; opacity: 1; transform: scale(1); }
    .nav-button { font-size: 3em; border: none; background: none; color: #fff; }

    /* Perk modal */
    #perk-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    #perk-modal-content { background-color: #0a0a0a; border: 4px solid #ffdc00; padding: 25px; max-width: 500px; color: #fff; }
    #perk-modal-close { position: absolute; top: -15px; right: -15px; width: 35px; height: 35px; background: red; color: white; border-radius: 50%; }

    /* Ghostface */
    #ghostface-ability-container { width: 90%; max-width: 400px; border: 2px solid #ff4136; padding: 10px; margin-bottom: 15px; }

    /* Myers */
    #myers-controls { width:90%; max-width:420px; margin:10px auto; border:2px dashed #555; padding:10px; }
    #myers-feed { width:100%; height:auto; background:#000; }
  </style>
</head>
<body>

  <!-- Join screen -->
  <div id="join-screen" class="container screen-constrained">
    <h1>Animatronic Setup</h1>
    <input type="text" id="player-name-input" placeholder="Enter Your Name" maxlength="12">
    <h2>Choose Your Color</h2>
    <div class="selection-group" id="color-selector">
      <div class="color-swatch" data-color="#ff4136" style="background:#ff4136;"></div>
      <div class="color-swatch" data-color="#0074d9" style="background:#0074d9;"></div>
      <div class="color-swatch" data-color="#2ecc40" style="background:#2ecc40;"></div>
      <div class="color-swatch" data-color="#ffdc00" style="background:#ffdc00;"></div>
      <div class="color-swatch" data-color="#b10dc9" style="background:#b10dc9;"></div>
    </div>
    <h2>Choose Your Avatar</h2>
    <div id="avatar-selection-area">
      <button id="show-avatar-screen-button">Select Avatar</button>
      <img id="selected-avatar-preview">
    </div>
    <input type="text" id="room-code-input" placeholder="Enter Room Code" maxlength="4">
    <button id="join-button">Join Game</button>
  </div>

  <!-- Avatar selection -->
  <div id="avatar-screen" class="container hidden">
    <h1>Choose Your Animatronic</h1>
    <h2 id="avatar-name-display">Freddy <button id="perk-info-button">i</button></h2>
    <div id="avatar-carousel"><div id="avatar-strip"></div></div>
    <button id="confirm-avatar-button">Select This Animatronic</button>
  </div>

  <!-- Controls -->
  <div id="controls-screen" class="container screen-constrained hidden">
    <h1 id="room-title">Room: ABCD</h1>

    <!-- Ghostface ability -->
    <div id="ghostface-ability-container" class="hidden">
      <h2>Mark for Death</h2>
      <button id="mark-for-death-btn" class="ability-btn">Activate Ability</button>
    </div>

    <!-- Myers ability -->
    <div id="myers-controls" class="hidden">
      <h2>Michael Myers — Stalk</h2>
      <button id="myers-stalk-btn" class="ability-btn">Stalk Guard</button>
      <p id="myers-status">Stalk ready.</p>
      <video id="myers-feed" autoplay playsinline></video>
    </div>

    <!-- General abilities -->
    <div class="controls-buttons">
      <button id="ad-button">Annoying Ad</button>
      <button id="sabotage-button">Sabotage Task</button>
      <button id="glitch-button">System Glitch</button>
      <input type="text" id="message-input" placeholder="Type a message..." maxlength="50">
      <button id="send-button">Send Message</button>
      <button class="sound-btn" data-sound="laugh">Freddy's Laugh</button>
    </div>

    <ul id="message-log" class="hidden"></ul>
  </div>

  <!-- Perk modal -->
  <div id="perk-modal" class="hidden">
    <div id="perk-modal-content">
      <button id="perk-modal-close">X</button>
      <h3 id="modal-avatar-name"></h3>
      <h4 id="modal-perk-name"></h4>
      <p id="modal-perk-description"></p>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    const socket = io();

    // --- simplified: only showing Myers-specific bits here ---
    const myersControls = document.getElementById('myers-controls');
    const myersStalkBtn = document.getElementById('myers-stalk-btn');
    const myersStatus = document.getElementById('myers-status');
    const myersFeed = document.getElementById('myers-feed');
    let myersPc = null;

    myersStalkBtn.addEventListener('click', () => {
      socket.emit('use-special-ability', { ability: 'myersWatch' });
      myersStatus.textContent = "Stalking… waiting for stream.";
    });

    socket.on('myers-offer', async (data) => {
      try {
        myersPc = new RTCPeerConnection();
        myersPc.ontrack = (event) => { myersFeed.srcObject = event.streams[0]; };
        await myersPc.setRemoteDescription(data.offer);
        const answer = await myersPc.createAnswer();
        await myersPc.setLocalDescription(answer);
        socket.emit('myers-answer', { guardId: data.guardId, answer });
      } catch (err) { console.error(err); }
    });

    socket.on('myers-ice-candidate', async (data) => {
      if (myersPc && data.candidate) {
        await myersPc.addIceCandidate(new RTCIceCandidate(data.candidate));
      }
    });

    socket.on('myers-watch-stop', () => {
      if (myersPc) myersPc.close();
      myersFeed.srcObject = null;
      myersStatus.textContent = "Stalk ended.";
    });
  </script>
</body>
</html>
